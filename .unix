#!/bin/bash

# starting up
sudo apt update && sudo apt upgrade
sudo update-alternatives --config editor # 3
    # macos
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"   # install homebrew
    brew update && brew upgrade
    brew install git

# create ssh key pairs
ls -al ~/.ssh                                       # check if a key exists
ssh-keygen -t rsa -b 4096 -C "van@[machinename]"    # generate a new key pair
# add ssh key to agent
eval "$(ssh-agent -s)"      # start ssh-agent in background
ssh-add ~/.ssh/id_rsa       # add key to agent
    # macs
    open ~/.ssh/config      # check if file exists
    touch  ~/.ssh/config    # create if not exists
    # add the following to config to store the ssh key in os keychain:
    #   Host *
    #   AddKeysToAgent yes
    #   UseKeychain yes
    #   IdentityFile ~/.ssh/id_rsa
    ssh-add -K ~/.ssh/id_rsa
cat ~/.ssh/id_rsa.pub | xclip -selection c      # get [local] public key
                                                # macos: use pbcopy instead of xclip
ssh-copy-id [user]@[remote]                     # add [local] public key to [remote]
ssh [user]@[remote] "cat ~/.ssh/id_rsa.pub" | xclip -selection c    # get public key of [remote]
echo '[public key]' >> ~/.ssh/authorized_keys                       # manage authorized keys
echo '[remote IP address] [remote name]' | sudo tee -a /etc/hosts   # use name instead of ip address

# git
ssh -T git@github.com   # test ssh connection to git
git config --global core.editor "vim"
git config --global user.name "van"
git config --global user.email "-"
git clone git@github.com:lvnfg/dot.git ~/desktop/dot

# link dotfiles
ln -s ~/dot/.vimrc      ~/.vimrc
ln -s ~/dot/.zshrc      ~/.bashrc    # use .zshrc for bash scripts
ln -s ~/dot/.zshrc      ~/.zshrc

# ---vmdev-backup-cli ends---

# desktop environment
sudo apt install --no-install-recommends lubuntu-desktop    # try sudo pat install lxde to see if this is even smaller
sudo apt install xrdp
sudo systemctl status xrdp  # verify xrdp is running
vim /etc/xrdp/startwm.sh    # edit setting xrdp settings to enable use of lxde
                            # comment out the last 2 lines and add:
                            #   lxsession -s Lubuntu -e LXDE
sudo service xrdp restart   # restart xrdp. (sudo systemctl restart xrdp?)

# ---vmdev-backup-lubuntu ends---

# vs code
ln -s ~/dot/code/settings.json      ~/.config/Code/settings.json
ln -s ~/dot/code/keybindings.json   ~/.config/Code/keybindings.json
ln -s ~/dot/code/snippets           ~/.config/Code/snippets\
    # macos
    ln -s ~/dot/code/settings.json      ~/Library/Application\ Support/Code/User/settings.json
    ln -s ~/dot/code/keybindings.json   ~/Library/Application\ Support/Code/User/keybindings.json
    ln -s ~/dot/code/snippets           ~/Library/Application\ Support/Code/User/snippets

# azure cli
sudo apt-get update
sudo apt-get install ca-certificates curl apt-transport-https lsb-release gnupg
curl -sL https://packages.microsoft.com/keys/microsoft.asc |
    gpg --dearmor |
    sudo tee /etc/apt/trusted.gpg.d/microsoft.asc.gpg > /dev/null
AZ_REPO=$(lsb_release -cs)
echo "deb [arch=amd64] https://packages.microsoft.com/repos/azure-cli/ $AZ_REPO main" |
    sudo tee /etc/apt/sources.list.d/azure-cli.list
sudo apt-get update
sudo apt-get install azure-cli
    # ---macos---
    brew install azure-cli
az configure  # configure default output to table
